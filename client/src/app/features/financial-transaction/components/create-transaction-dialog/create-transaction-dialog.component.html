<div class="create-transaction-container">
  <h2 mat-dialog-title>Nova Transação</h2>

  <form [formGroup]="form" (ngSubmit)="onSubmit()">
    <mat-dialog-content>
      <div class="form-container" style="display: flex; flex-direction: column;">
        <mat-form-field appearance="outline" style="width: 100%;">
          <mat-label>Descrição</mat-label>
          <input matInput formControlName="description" required>
        </mat-form-field>

        <mat-form-field appearance="outline" style="width: 100%;">
          <mat-label>Valor</mat-label>
          <input matInput type="number" formControlName="amount" required>
        </mat-form-field>

        <mat-form-field appearance="outline" style="width: 100%;">
          <mat-label>Data de Vencimento</mat-label>
          <input matInput [matDatepicker]="picker" formControlName="dueDate" required>
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline" style="width: 100%;">
          <mat-label>Tipo</mat-label>
          <mat-select formControlName="type" required>
            <mat-option *ngFor="let type of transactionTypes" [value]="type.value">
              {{type.label}}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-slide-toggle formControlName="isPaid" class="mat-form-field-should-float" style="width: 100%; margin-bottom: 1em;">
          Lançar pago?
        </mat-slide-toggle>

        <div class="parcela-section" *ngIf="!isReceivableBill" style="margin-top: 16px;">
          <mat-slide-toggle
            formControlName="isInstallment"
            class="parcela-toggle"
            color="primary">
            Parcelado?
          </mat-slide-toggle>

          <mat-form-field
            appearance="outline"
            style="width: 100%; margin-top: 16px;"
            *ngIf="isInstallment">
            <mat-label>Número de Parcelas</mat-label>
            <input matInput type="number" formControlName="installmentCount" min="2" max="24" placeholder="2">
            <mat-hint class="parcela-hint">Cada parcela será criada mensalmente a partir da data selecionada</mat-hint>
            <mat-error *ngIf="form.get('installmentCount')?.hasError('required')">Número de parcelas é obrigatório</mat-error>
            <mat-error *ngIf="form.get('installmentCount')?.hasError('min')">Mínimo de 2 parcelas</mat-error>
            <mat-error *ngIf="form.get('installmentCount')?.hasError('max')">Máximo de 24 parcelas</mat-error>
          </mat-form-field>
        </div>

        <!-- Informação sobre o valor das parcelas -->
        <div class="parcela-info" *ngIf="!isReceivableBill && isInstallment && form.get('amount')?.valid && form.get('installmentCount')?.valid" style="display: flex; align-items: center; margin-top: 8px; padding: 8px; background-color: #f5f5f5; border-radius: 4px;">
          <mat-icon style="margin-right: 8px; color: #666;">info</mat-icon>
          <span style="font-size: 14px; color: #666;">
            {{form.get('installmentCount')?.value}} parcelas de
            {{(form.get('amount')?.value / form.get('installmentCount')?.value) | currency:'BRL':'symbol':'1.2-2':'pt-BR'}}
          </span>
        </div>
      </div>
    </mat-dialog-content>

    <mat-dialog-actions align="end">
      <button mat-button type="button" (click)="onCancel()">Cancelar</button>
      <button mat-raised-button color="primary" type="submit" [disabled]="!form.valid">
        {{isInstallment ? 'Criar Parcelas' : 'Salvar'}}
      </button>
    </mat-dialog-actions>
  </form>
</div>
