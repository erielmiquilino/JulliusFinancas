version: '3.8'

services:
  app:
    image: ${DOCKER_REGISTRY}/jullius-financas:latest
    container_name: jullius-monolith
    restart: always
    env_file: .env
    networks:
      - proxy-net
    environment:
      - ConnectionStrings__DefaultConnection=Host=${DB_HOST};Database=${DB_NAME};Username=${DB_USER};Password=${DB_PASSWORD};Port=5432;
      - Jwt__SecretKey=${JWT_SECRET_KEY}
      - Jwt__Issuer=JulliusFinancas
      - Jwt__Audience=JulliusFinancas
      - Jwt__AccessTokenExpirationMinutes=15
      - Jwt__RefreshTokenExpirationDays=30
      - Smtp__Host=${SMTP_HOST}
      - Smtp__Port=${SMTP_PORT}
      - Smtp__Username=${SMTP_USERNAME}
      - Smtp__Password=${SMTP_PASSWORD}
      - Smtp__UseSsl=true
      - Smtp__FromName=Jullius Finan√ßas
      - Smtp__FromEmail=${SMTP_FROM_EMAIL}
      - Admin__Email=${ADMIN_EMAIL}
      - Admin__Password=${ADMIN_PASSWORD}
      - Admin__Name=Administrador
      - App__FrontendBaseUrl=https://${DOMAIN_NAME}
    volumes:
      - jullius_dataprotection_keys:/var/jullius/keys
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.jullius.rule=Host(`${DOMAIN_NAME}`)"
      - "traefik.http.routers.jullius.entrypoints=web"
      - "traefik.http.routers.jullius-secure.rule=Host(`${DOMAIN_NAME}`)"
      - "traefik.http.routers.jullius-secure.entrypoints=websecure"
      - "traefik.http.routers.jullius-secure.tls=true"
      - "traefik.http.routers.jullius-secure.tls.certresolver=myresolver"
      - "traefik.http.services.jullius.loadbalancer.server.port=80"

networks:
  proxy-net:
    external: true

volumes:
  jullius_dataprotection_keys:
